
<!DOCTYPE html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>Import MS Project file</title>
	<script src="../../codebase/dhtmlxgantt.js?v=20180322"></script>
	<script src="../../codebase/ext/dhtmlxgantt_smart_rendering.js?v=20180322"></script>
	<script src="https://export.dhtmlx.com/gantt/api.js?v=20180322"></script>
	<script src="https://code.jquery.com/jquery-1.7.1.min.js?v=20180322"></script>
	<script src="../common/snippets/dhx_file_dnd.js?v=20180322"></script>
	<link rel="stylesheet" href="../common/snippets/dhx_file_dnd.css?v=20180322">

	<link rel="stylesheet" href="../../codebase/dhtmlxgantt.css?v=20180322">

	<style>
	html, body {
		height: 100%;
		padding: 0;
		margin: 0;
		overflow: hidden;
		font-family: Arial;
	}

	.mpp-sample {
		background: url("common/ms-project.png");
		width: 32px;
		height: 32px;
		background-repeat: no-repeat;
		padding-left: 40px;
		line-height: 32px;
		display: inline-block;
	}
</style>
</head>

<body>
	<div style="text-align: center; padding: 5px; display: none;">
		<p>
			You can use any MPP or XML Project file or download this sample <a class="mpp-sample"
			href="../common/DemoProject.mpp"
			target="_blank">DemoProject.mpp</a>
		</p>
		<p>
			<form id="mspImport" action="" method="POST" enctype="multipart/form-data">
				<input type="file" id="mspFile" resize:true, name="file"
				accept=".mpp,.xml, text/xml, application/xml, application/vnd.ms-project, application/msproj, application/msproject, application/x-msproject, application/x-ms-project, application/x-dos_ms_project, application/mpp, zz-application/zz-winassoc-mpp"/>
				<button id="mspImportBtn" type="submit">Load from MPP</button>
			</form>
		</p>
	</div>
	<div id="gantt_here" style='width:100%; height:600px;'></div>
	<script>
		gantt.config.xml_date = "%Y-%m-%d %H:%i:%s";

				gantt.config.columns = [
		    {resize:true, name:"text",  label:"任务名称", with:"*",tree:true },
		    {resize:true, name:"start_date", label:"开始日期", align:"center" },
		    {resize:true, name:"end_date", label:"结束日期", align:"center" },
		    {resize:true, name:"duration",   label:"工期", align:"center" },
		    {resize:true, name:"quantities",  label:"工程量",  width:44 , align:"center"},
		    {resize:true, name:"unit",  label:"单位",  width:44, align:"center" },
		    {resize:true, name:"worktime",  label:"工时",  width:44, align:"center" },
		    {resize:true, name:"add",  label:"",width:44, align:"center" }
		];

		gantt.config.scale_unit = "week"; 
		gantt.config.date_scale = "Week #%W";
		gantt.config.open_tree_initially = true

		gantt.init("gantt_here");

		gantt.load('/data')

		

		// var dp = new gantt.dataProcessor("/data");
		// dp.init(gantt);
		// dp.setTransactionMode("REST");

		// gantt.config.row_height = 24;
		// gantt.config.xml_date = "%Y-%m-%d %H:%i";

		// gantt.attachEvent("onParse", function () {
		// 	gantt.eachTask(function (task) {
		// 		if (gantt.hasChild(task.id)) {
		// 			task.type = gantt.config.types.project;
		// 			gantt.updateTask(task.id);
		// 		} else if (task.duration === 0) {
		// 			task.type = gantt.config.types.milestone;

		// 			gantt.updateTask(task.id);
		// 		}
		// 	});
		// });


		// if (!window.FormData) {
		// 	gantt.error("Your browsers does not support Ajax File upload, please open this demo in modern browser");
		// }

		// gantt.config.static_background = true;

		// gantt.config.xml_date = "%Y-%m-%d %H:%i";
		// gantt.config.scale_unit = "week"; 
		// gantt.config.date_scale = "Week #%W";
		// gantt.init("gantt_here");

		// var fileDnD = fileDragAndDrop();
		// fileDnD.init(gantt.$container);

		// function sendFile(file) {
		// 	fileDnD.showUpload();
		// 	upload(file, function () {
		// 		fileDnD.hideOverlay();
		// 	})
		// }

		// function upload(file, callback) {
		// 	gantt.importFromMSProject({
		//     server:"https://export.dhtmlx.com/gantt/project", 
		//     taskProperties: ["HyperlinkSubAddress","ID","IgnoreResourceCalendar","IsNull","IsSubproject","IsSubprojectReadOnly","LateFinish","LateStart","LevelAssignments","LevelingCanSplit","LevelingDelay","LevelingDelayFormat","Milestone","Name","Notes","OutlineLevel","OutlineNumber","OverAllocated","OvertimeCost"," ","OvertimeWork","PercentComplete","PercentWorkComplete","PhysicalPercentComplete","PreLeveledFinish","PreLeveledStart","Priority","Recurring","RegularWork","RemainingCost","RemainingDuration","RemainingOvertimeCost","RemainingOvertimeWork","RemainingWork","Resume","ResumeValid","Rollup","Start","StartVariance","Stop","SubprojectName","Summary","TotalSlack","Type","WBS","WBSLevel","Work","WorkVariance","UID"],
		//     data: file,
		//     callback: function(project){
		//        // some logic

		//        console.log(project)
		//     }
		// });
		// }

		// fileDnD.onDrop(sendFile);
		// var form = document.getElementById("mspImport");
		// form.onsubmit = function (event) {
		// 	event.preventDefault();
		// 	var fileInput = document.getElementById("mspFile");
		// 	sendFile(fileInput.files[0]);
		// };
	</script>
</body>